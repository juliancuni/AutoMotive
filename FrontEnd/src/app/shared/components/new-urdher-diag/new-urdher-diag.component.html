<div class="draggable-box" cdkDrag *ngIf="showUrdherDiag">
    <div class="draggable-handle" cdkDragHandle>
        <span class="float-left ml-3 mr-1">Urdhër Diagnoze</span>
        <span class="float-left text-primary">{{ urdherDiag?.mjeti?.brand }}</span><span
            class="ml-1">{{ urdherDiag?.mjeti?.targa }}</span>
        <button type="button" class="close mr-3" aria-label="Close" (click)="toggle()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <hr>
    <form class="form-horizontal m-3" [formGroup]="urdheDiagForm"
        (submit)="regUrdherDiagnoze($event, urdheDiagForm.value)">
        <div class="form-group row">
            <label class="text-bold col-3 col-form-label text-right" for="emer">Klienti</label>
            <div class="col-7">
                <div class="input-group with-focus input-group-sm">
                    <ng-template #rt let-r="result" let-t="term">
                        <ngb-highlight [result]="r.emer" [term]="t"></ngb-highlight>
                    </ng-template>
                    <input id="klientiId" type="text" class="form-control" [ngbTypeahead]="searchKlientet"
                        (focus)="focusKlientet$.next($event.target.value)"
                        (click)="clickKlientet$.next($event.target.value)" [resultTemplate]="rt"
                        [inputFormatter]="formatterKlientet" #instance="ngbTypeahead" placeholder="Zgjidh klientin"
                        formControlName="klient" />
                    <div class="input-group-append" (click)="clearKlient()">
                        <a class="input-group-text bg-transparent border-left-0" title="Pastro fushën">
                            <em
                                [ngClass]="{'fas fa-circle text-muted': urdherDiag?.id, 'fa fa-window-close': !urdherDiag?.id }"></em>
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-1">
                <button class="btn btn-primary" type="button" title="Regjistro klient të ri"
                    (click)="showNewKlient = !showNewKlient" [disabled]="urdherDiag?.id">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
        <div class="form-group row">
            <label class="text-bold col-3 col-form-label text-right" for="emer">Përfaqësuesi</label>
            <div class="col-7">
                <select class="form-control" formControlName="perfaqesues" [compareWith]="compareFn">
                    <option [ngValue]="null" disabled [selected]="true" *ngIf="!urdherDiag?.id">Zgjidh</option>
                    <option *ngFor="let perfaqesues of perfaqesuesitEklientit" [ngValue]="perfaqesues">
                        {{perfaqesues?.emer}}</option>
                </select>
            </div>
            <div class="col-1">
                <button class="btn btn-primary" type="button" title="Regjistro perfaqesues për këtë klient"
                    (click)="showNewPerfaqesues = !showNewPerfaqesues" [disabled]="!klientIzgjedhur">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
        <div class="form-group row">
            <label class="text-bold col-3 col-form-label text-right" for="emer">Mjeti</label>
            <div class="col-7">
                <select class="form-control" formControlName="mjeti" [compareWith]="compareFn">
                    <option [ngValue]="null" disabled [selected]="true" *ngIf="!urdherDiag?.id">Zgjidh</option>
                    <option *ngFor="let mjeti of mjetetEklientit" [ngValue]="mjeti">{{mjeti?.brand}} |
                        {{mjeti?.targa}}
                    </option>
                </select>
            </div>
            <div class="col-1">
                <button class="btn btn-primary" type="button" title="Regjistro mjet të ri për këtë klient"
                    (click)="showNewMjet = !showNewMjet" [disabled]="!klientIzgjedhur || urdherDiag?.id">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
        <div class="form-group row">
            <label class="text-bold col-3 col-form-label text-right" for="emer">Punonjësi</label>
            <div class="col-7">
                <select class="form-control" formControlName="destinuarPer" [compareWith]="compareFn">
                    <option [ngValue]="null" disabled [selected]="true" *ngIf="!urdherDiag?.id">Zgjidh</option>
                    <option *ngFor="let perdorues of perdoruesit" [ngValue]="perdorues">{{perdorues?.emer}}
                        {{perdorues?.mbiemer}}</option>
                </select>
            </div>
            <div class="col-1">
                <button class="btn btn-primary" type="button" title="Regjistro punonjës të ri"
                    (click)="showNewPerdorues = !showNewPerdorues" [disabled]="!klientIzgjedhur">
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
        <div class="form-group row">
            <label class="text-bold col-3 col-form-label text-right" for="kontrolliId">Check-Up</label>
            <div class="col-7">
                <div class="input-group input-group-sm">
                    <ng-template #rt let-r="result" let-t="term">
                        <ngb-highlight [result]="r.emer" [term]="t" (click)="shtoKontroll(r)"></ngb-highlight>
                        <ngb-highlight (click)="shtoKontroll(r)" *ngIf="!result">Term: {{term}}</ngb-highlight>
                    </ng-template>
                    <input id="kontrolliId" type="text" class="form-control" [ngbTypeahead]="searchKontrolle"
                        (focus)="focusKontrolle$.next($event.target.value)"
                        (click)="clickKontrolle$.next($event.target.value)" [resultTemplate]="rt"
                        [inputFormatter]="formatterKontrolle" #instance="ngbTypeahead"
                        placeholder="Kontrolle të zakonshme" formControlName="kontrolle" />
                    <div class="input-group-append" (click)="ruajNewKontrolleFunction()" *ngIf="kontrollNukEgziston">
                        <a class="input-group-text bg-transparent border-left-0" title="Shto Check-Up">
                            <em class="far fa-save"></em>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group row" *ngIf="katKontrolleTeZgjedhura?.length > 0">
            <span class="col-3"></span>
            <div class="col-7">
                <div class="d-flex" *ngFor="let kontroll of katKontrolleTeZgjedhura; let i=index;">
                    <span class="float-left">{{i+1}}. {{kontroll?.emer}}</span>
                    <span class="ml-auto">
                        <button class="btn btn-square btn-xs" title="Hiqe nga lista" (click)="hiqKontroll(kontroll)">
                            <i class="far fa-window-close"></i>
                        </button>
                    </span>
                </div>
            </div>
        </div>
        <div class="form-group row">
            <label class="text-bold col-3 col-form-label text-right" for="kontrolliId">Shënime</label>
            <div class="col-7">
                <textarea rows="" class="form-control" formControlName="shenime" placeholder="Shënime"></textarea>
            </div>
        </div>
        <div class="form-group row">
            <label class="text-bold col-3 col-form-label text-right" for="kontrolliId">Prioriteti</label>
            <div class="col-7">
                <input type="range" class="form-control-range" id="formControlRange" formControlName="prioriteti"
                    min="1" max="3">
            </div>
            <div class="col-1">
                <small
                    [ngClass]="{'text-muted': prioriteti === 1, 'text-primary': prioriteti === 2, 'text-danger': prioriteti === 3}">{{prioriteti === 1 ? 'iUlët' : prioriteti === 2 ? 'Normal' : prioriteti === 3 ? 'iLartë' : ''}}</small>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-12">
                <button class="btn btn-sm btn-danger mr-2" type="button" *ngIf="urdherDiag?.id"
                    (click)="fshiKonfirm = !fshiKonfirm">Fshije</button>
                <span class="block" *ngIf="fshiKonfirm">
                    <button class="btn btn-warning btn-xs mr-1" type="button"
                        (click)="deleteUrdherDiagnoze(urdherDiag)">Po</button>
                    <button class="btn btn-info btn-xs" type="button" (click)="fshiKonfirm = !fshiKonfirm">Jo</button>
                </span>
                <button class="btn btn-sm btn-secondary float-right" type="button" (click)="toggle()">Mbyll</button>
                <button class="btn btn-sm btn-secondary mr-2 float-right" type="submit"
                    [disabled]="!urdheDiagForm.valid">Ruaj</button>
            </div>
        </div>
    </form>
</div>
<!-- new klient Form -->
<app-new-klient [showNewKlient]="showNewKlient" (hapMbyllNKNgaSelf)="hapMbyllNgaNKChild($event)"
    (shtoKlient)="shtoKlient($event)"></app-new-klient>
<!-- End new klient Form -->
<!-- new Perfaqesues Form -->
<app-new-perfaqesues [showNewPerfaqesues]="showNewPerfaqesues" [klient]="klient"
    (hapMbyllNPFNgaSelf)="hapMbyllNgaNPFChild($event)" (shtoPerfaqesues)="shtoPerfaqesues($event)">
</app-new-perfaqesues>
<!-- End new Perfaqesues Form -->
<!-- new Mjet Form -->
<app-new-mjet [showNewMjet]="showNewMjet" [klient]="klient" (hapMbyllNMNgaSelf)="hapMbyllNgaNMChild($event)"
    (shtoMjet)="shtoMjet($event)"></app-new-mjet>
<!-- End new Mjet Form -->
<!-- new Perdorues Form -->
<app-new-perdorues [showNewPerdorues]="showNewPerdorues" (hapMbyllNPNgaSelf)="hapMbyllNgaNPChild($event)"
    (shtoPerdorues)="shtoPerdorues($event)"></app-new-perdorues>
<!-- End new Perdorues Form -->